---
title: 'Project 2'
subtitle: 'BPI889 placebo data'
author: 'Christina Baidya Otoshi'
date: '2018-11-22'
output: 
  html_document: 
    code_folding: show
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
      smooth_scroll: true
---



---

# Setup Environment




## Load R Packages


**Questions:** in the chunk option below, i.e `{r load packages, message = FALSE}`

1. What language was used?
* R
2. What is the name of the chunk?
* load packages
3. What does the `message = FALSE` option do?
* prevents messages that are generated by code from appearing in the finished file.

```{r load packages, message = FALSE}
library(tidyr)    # used for putting data into long format
library(knitr)    # used for creation of the report

# Enter the name of any additional packages used here

```


## Load the Data Sets
### Set the Working Directory


**Question:**

1. What are the names of the sub-directories present under `/Data`?


### Define the Pathways




#### Define the Pathway for the `PD` Data Set


```{r define pd path}
dir_name_pd   <- '../ICW_BasicR/'
file_name_pd  <- 'BPI889_PD_run-in.csv'
file_path_pd  <- paste(dir_name_pd, file_name_pd, sep = '')
```


**Question:** 

1. With relative paths what do `.` and `..` mean?
* '.'means current dictionary, and '..' means upper level dictionary.

#### Define the Pathway for the `COV` Data Set



```{r define cov path}
dir_name_cov   <- '../ICW_BasicR/'
file_name_cov  <- 'BPI889_demographics.tab'
file_path_cov  <- paste(dir_name_cov, file_name_cov, sep = '')
```





### Import the Data Sets
#### Import `PD` Data Set



```{r read-in pd}
data_pd <- read.csv(file = 'BPI889_PD_run-in.csv', header = TRUE, as.is = TRUE, na.strings = '.')
```


#### Import `COV` Data Set



```{r read-in cov}
data_cov <- read.table(file = 'BPI889_demographics.tab', header = TRUE, as.is = TRUE)
```

**Questions:** 

1. What does the option `header = TRUE` do?
* the first row is used as name.
2. Why was the option `as.is = TRUE` used?
* 'as.is' is used to inhibit transfter string into factor.

# Input Check
## Check Imported Data Sets



### Structure of the `PD` data set



```{r pd structure}
str(data_pd)
```


**Questions:** using the output of the `str()` function

1. How many rows and columns does the `PD` data set has?
* 300 rows and 4 columns
2. What does `chr` and `int` refer to in the output?
* characters,integer.
3. Can you explain why the column names of the `PD` data set are different from the name seen in the `.csv` file with the Rstudio viewer (i.e. first column named `X` and spaces have been replaced by dots in the other columns)?
* R automatically regards first colume is X and transfer through its own grammar from spaces to dot.

### Structure of `COV` Data Set



```{r cov structure}
str(data_cov)
```


**Question:** using the output of the `str()` function:

1. How many rows and columns does the `COV` data set has?
* 300 rows 7 columns

## Glance at the Data Sets




### Head of the `PD` Data Set



```{r knitr kable example, eval = FALSE}
# This is an example do not write code here
kable(x = data_pd,
      align = 'c',
      row.names = FALSE,
      caption = 'individual data')
```

```{r pd head table}
head_pd <- head(data_pd, n = 5L)

```


**Question:**

1. What does the chunk option `eval = FALSE` used in the example do?
* when run do not reveal the code on the report.

### Head of the `COV` Data Set


```{r knitr kable example2, eval = FALSE}
# This is an example do not write code here
kable(x = data_cov,
      align = 'c',
      row.names = FALSE,
      caption = 'run-in period of the study')
```

```{r cov head table}
head_cov <- head(data_cov, n = 5L)

```


# Data Management 
## The `PD` Data Set
### Set `ID` Column Name



```{r pd id column}
colnames(data_pd)[1] <- c('ID')
```


### Transform the Data Set to Long Format

```{r tidy pd data}
data_pd2 <- gather(data  = data_pd,
                  key   = TIME,
                  value = CD4, -ID )
```


```{r pd head long}
nrow(data_pd2)
ncol(data_pd2)
head_pd2 <- head(data_pd2, n = 5L)
kable(x = head_pd2,
      align = 'c',
      row.names = FALSE,
      caption = 'individual data-long format')
```


### Create Numeric `CD4` Column


```{r convert cd4 numeric}
data_pd2$CD4 <- as.numeric(data_pd2$CD4)
```


**Question:** 

1. Why do you get the warning message: `NAs introduced by coercion` when converting the `CD4` column into `numeric`?
* numbers have '.'(lack statistics has been replaced by '.') in them.

### Create Numeric `TIME` Column



```{r convert time numeric}
data_pd2$TIME <- gsub('day.','',data_pd2$TIME)
data_pd2$TIME <- as.numeric(data_pd2$TIME)
```


**Question:**

1. What does `'[^0-9]'` pattern mean?
* The [^0-9] expression is used to find any character that is NOT a digit.

## The `COV` Data Set
### Format Categorical Data



#### Factorize the `SEX` Column



```{r factor example, eval = FALSE}
# This is an example do not write code here
factor(x      = mtcars$cyl,
       levels = c(4, 6, 8),
       labels = c('Small', 'Medium', 'Big')
```

where:

- `x` is the vector (or column) to be factorized.
- `levels` are all the unique values present in `x`.
- `labels` attributes a label to each level. It is very important to have the `levels` and the `labels` in the same order.

```{r convert sex to factor}
data_cov$SEX <- factor(x = data_cov$SEX,
                        levels = c('M', 'F'),
                        labels = c('Male', 'Female' ))
```


#### Factorize the `TB` Column



```{r convert tb to factor}
data_cov$TB <- factor(x = data_cov$TB,
                      levels = c('0', '1'),
                      labels = c('HIV', 'HIV+TB'))
```


### Create the `BMI` Column





```{r bmi calculation}
data_cov$BMI <- data_cov$WT/(data_cov$HT/100)**2
data_cov$BMI <- round(data_cov$BMI, 2)
```


### Create the `CBMI` Column



```{r cbmi calculation}
data_cov$CBMI <- ifelse(data_cov$BMI >= 30, 4,
                        ifelse(data_cov$BMI >= 25, 3,
                               ifelse(data_cov$BMI >= 18.5, 2,1)))
data_cov$CBMI <- factor(x = data_cov$CBMI, 
                        levels = c(1, 2, 3, 4),
                        labels = c('underweight', 'normal', 'overweight', 'obese'))
table(data_cov$CBMI)
```

**Questions:** using the results from the `table()` function, are there any:

1. Obese subjects?
* 60
2. Underweight subjects?
* 0

### Create the `FFM` Column




```{r create fat free mass}

data_cov$FFM <- ifelse(data_cov$SEX == 'Female',37.99*(data_cov$HT/100)**2*data_cov$WT/(35.98*(data_cov$HT/100)**2 + data_cov$WT), 42.92*data_cov$WT*(data_cov$HT/100)**2/(30.93*(data_cov$HT/100)**2 + data_cov$WT) )

data_cov$FFM <- round(data_cov$FFM, 1)
```


### Create the `AECD4` Column



```{r create cd4 adverse events}
data_cov$AECD4 <- ifelse(data_cov$BCD4 > 500, 1,
                         ifelse(data_cov$BCD4 >= 200, 2,
                                ifelse(data_cov$BCD4 >= 50, 3, 4)))
data_cov$AECD4 <- factor(data_cov$AECD4, levels = c(1, 2, 3, 4), labels = c( 'mild', 'moderate', 'severe', 'life-threatening'))
```


## Save the Data to an R Archive


```{r save cov data set as RData}
dir <- '../Data/COV/'
save(data_cov, file = 'BPI889_covariates_formated.RData')
```


## Merge `PD` and `COV` Data Sets
### Perform the Merge



```{r merge pd and cov}
data_all <- merge(data_cov, data_pd2, by ='ID')
```


**Question:** 

1. Why did we use the `merge()` function and not a simple column bind (`cbind()`) to combine the `PD` and `COV` data set?

* `merge()` is used to two data frames having the same time or observation, but the columns are different.
* `cbind()` is used when needing to merge different types of variables from the same observation object.

### Evaluate the Merge



```{r str and head of data_all}
str(data_all)
kable(x = head(data_all, n = 5L),
      align = 'c',
      row.names = FALSE,
      caption = 'all data' )
```


**Questions:** 

1. Compare the number of rows of `data_all` to `data_cov` and `data_pd`. Can you explain these differences?
* the number of `data_all` row depends on the max row of the two data.
2. Same question with the number of columns.
* the columns is the mixture of `data_cov` and `data_pd`,depends on the ID,the other columns are summary of the two columes of the `data_cov` and `data_pd`.

### Arrange the Data
#### Reorder Columns


```{r reorder columns}

data_all <- subset(data_all, select = c(ID, TIME, CD4, BCD4, AECD4,BVL, WT, HT, FFM, BMI, CBMI, SEX, TB))
```


#### Reorder Rows



```{r reorder rows}
data_all <- data_all[order(data_all$ID, data_all$TIME), ]
```


# Data Summary



## Summary of Time Varing Columns



```{r time varying summary}
summary(data_all)
```


**Questions:** 

1. What is the range of `TIME`? 
* 0-14

2. What is the range of `CD4` count?  
* 101.6-376.6

3. Do you think that missingness is a problem with these data?
* it doesn't matter,because the summary will exclude NA when find max,min and mean,and count the number of NA.

**Bonus question:**

1. Can you think of an alternative we could have used to generate a summary for each of the studied time points (i.e. 0, 7 and 14 days)?
??????

## Summary of Time Constant Columns





```{r create data_unique}
data_unique <- data_all[!duplicated(data_all$ID), ]
```


### Continuous Variables



```{r summary non-time varying continuous}
summary(subset(data_unique, select = c(BCD4, BVL, WT, HT, FFM, BMI)))
```


### Discrete Variables



```{r summary non-time varying discrete}
summary(subset(data_unique, select = c(AECD4, CBMI, SEX, TB)))
```


# Graphical Analysis




## CD4 Time Profiles


```{r cd4 time profiles}
# This is an example do not write code here
plot(y = data_all$CD4, x = data_all$TIME, type = 'n', ylim = range(100: 500))
for(n in unique(data_all$ID)) {
  lines(y = data_all$CD4[data_all$ID == n],
        x = data_all$TIME[data_all$ID == n],
        col = ifelse(data_all$TB[data_all$ID == n] =='HIV', 'blue', 'red'))
}
abline(h = 500, col = "gray60")
legend('topright', legend = c('HIV', 'HIV+TB'), 
      col = c('blue', 'red'), lty = 1, bty = 'n')

```
  
- Or using `ggplot2`
    + Remember to load the package `ggplot2` in the dedicated R chunk in the beginning of this report.
    + Use the `group` aesthetic argument to get individual lines.
    + Use the `geom_abline(yintercept)` layer to add the horizontal line



**Questions:** what information does this plot reveal regarding: 

1. The difference between TB status?
* people suffering from both HIV and TB are more hard to achieve better treatment effect.
2. The trend over time?
* no trend

## Continuous Covariates
### Distribution



```{r histograms, fig.height = 5, fig.width = 5}
par(mfrow = c(2, 3))
for (cov in c('BCD4', 'BVL', 'WT', 'HT', 'FFM', 'BMI')) { 
  # Add code for the plot here
  hist(x = data_unique[,cov], xlab = NA, main = cov)
  }
```


**Questions:** what information does this plot reveal regarding:

1. The range of each covariate?
* BCD4:100-400
* BVL:5000-20000+
* WT:30-140
* HT:140-170
* FFM:20-100
* BMI:20-40
this is not covinient to see the range,compared with summary()
2. The shape of the distribution of each covariate?
* BCD4:170-200 the most
* BVL:around 10000
* WT:50-80 the most
* HT:110-220 most
* FFM:30-80 most
* BMI:27-28 most

### Correlation Matrix



```{r pairs plot}
# This is an example do not write code here
pairs(data_unique[,c('BCD4', 'BVL', 'WT', 'HT', 'FFM', 'BMI')],
      upper.panel = NULL,
      lower.panel = panel.smooth, 
      pch = 20)
```

```{r pair plot, fig.height = 6}

```


**Questions:**

1. Which covariates are highly correlated?
* WT-HT,WT-FFM,HT-FFM
2. Which covariates are poorly correlated?
* others

## Discrete Covariates
### Box Plots




```{r boxplots}
par(mfrow = c(2, 2))
boxplot(WT~CBMI, data = data_unique, main = 'WT~CBMI')
boxplot(FFM~SEX, data = data_unique, main = 'FFM~SEX')
boxplot(BCD4~TB, data = data_unique, main = 'BCD4~TB')
boxplot(BVL~AECD4, data = data_unique, main = 'BVL~AECD4')

```


**Questions:**

1. Can you find correlations between any of the covariates? 
* 1.no correlations
* 2.correlation
* 3.correlation
* 4.hard to see correlation
2. Provide a brief explanation on what could explain these correlations.
* FFM~SEX:female/male-muscle difference.
* HIV~TB:diseases have interaction.

---

**The End**
